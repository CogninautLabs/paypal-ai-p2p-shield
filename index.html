<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="AI-powered PayPal P2P scam shield. 100% on-device, offline, instant." />
  <title>PayPal AI P2P Shield</title>
  <link rel="manifest" href="manifest.json" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src https://fonts.gstatic.com;
    connect-src 'self';
    img-src 'self' data:;
  ">
  <style>
    :root {
      --bg: #0a1d37; --card: #112a50; --input: #0f233d; --text: #e8f0ff;
      --accent: #00d4ff; --accent-dark: #00a8cc; --danger: #ff3b5c; --safe: #00ff88;
      --warn: #ffd43b; --shadow: 0 8px 32px rgba(0,0,0,0.4);
      --border: rgba(0,212,255,0.2); --glow: 0 0 20px rgba(0,212,255,0.3);
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #0a1d37 0%, #001f3f 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 1.5rem;
      line-height: 1.6;
      background-attachment: fixed;
    }
    .container { max-width: 960px; margin: 0 auto; }
    header {
      text-align: center;
      padding: 2.5rem 0 2rem;
      position: relative;
    }
    .logo {
      width: 60px;
      height: 60px;
      background: radial-gradient(circle at 30% 30%, #00ff9d, #00d4ff);
      border-radius: 18px;
      margin: 0 auto 1rem;
      box-shadow: var(--glow);
      animation: pulse 3s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    h1 {
      background: linear-gradient(90deg, #00d4ff, #00ff9d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 2.6rem;
      font-weight: 700;
      margin: 0;
      letter-spacing: -0.5px;
    }
    .tagline {
      font-size: 1.15rem;
      opacity: 0.95;
      margin-top: 0.75rem;
      font-weight: 500;
    }
    .card {
      background: var(--card);
      padding: 1.75rem;
      border-radius: 20px;
      margin: 1.75rem 0;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 40px rgba(0,0,0,0.5);
    }
    .card h2 {
      color: var(--accent);
      margin: 0 0 1rem;
      font-weight: 600;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .card h2::before {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--accent);
      border-radius: 50%;
      box-shadow: 0 0 12px var(--accent);
    }
    .input-group {
      position: relative;
      margin: 1.25rem 0;
    }
    #noteInput {
      width: 100%;
      padding: 1rem 1.25rem;
      font-size: 1.1rem;
      border: 2px solid transparent;
      border-radius: 14px;
      background: var(--input);
      color: var(--text);
      transition: all 0.3s ease;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    #noteInput:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(0,212,255,0.2), var(--glow);
      transform: translateY(-1px);
    }
    .examples {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin: 1rem 0;
      font-size: 0.95rem;
    }
    .example-chip {
      background: rgba(0,212,255,0.15);
      color: var(--accent);
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid rgba(0,212,255,0.3);
    }
    .example-chip:hover {
      background: rgba(0,212,255,0.25);
      transform: translateY(-1px);
    }
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1rem;
    }
    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.85rem 1.75rem;
      font-size: 1rem;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,212,255,0.3);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
    }
    button::before {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    button:hover::before {
      left: 100%;
    }
    button:hover {
      background: var(--accent-dark);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,212,255,0.4);
    }
    button.danger {
      background: var(--danger);
      box-shadow: 0 4px 15px rgba(255,59,92,0.3);
    }
    button.danger:hover {
      background: #e02a4a;
      box-shadow: 0 8px 25px rgba(255,59,92,0.4);
    }
    #result {
      margin-top: 1.25rem;
      padding: 1.5rem;
      border-radius: 16px;
      font-weight: 600;
      min-height: 5rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    #result::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: inherit;
      filter: blur(12px);
      z-index: -1;
      opacity: 0.7;
    }
    .status {
      font-size: 1.35rem;
      margin: 0 0 0.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .status-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      animation: bounce 1.5s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }
    .meta {
      font-size: 0.95rem;
      opacity: 0.9;
      margin: 0.4rem 0 0;
      font-weight: 500;
    }
    .risk-bar {
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
      margin: 1rem 0 0.5rem;
    }
    .risk-fill {
      height: 100%;
      background: linear-gradient(90deg, #00ff88, #ffd43b, #ff3b5c);
      border-radius: 4px;
      transition: width 0.6s ease;
      position: relative;
    }
    .risk-fill::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    .footer {
      text-align: center;
      font-size: 0.85rem;
      color: #8899b3;
      margin-top: 4rem;
      padding-top: 2rem;
      border-top: 1px solid rgba(0,212,255,0.2);
    }
    .footer a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }
    .footer a:hover {
      text-decoration: underline;
    }
    .badge {
      display: inline-block;
      background: rgba(0,255,136,0.15);
      color: #00ff88;
      padding: 0.35rem 0.75rem;
      border-radius: 50px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-left: 0.5rem;
      border: 1px solid rgba(0,255,136,0.3);
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f8faff; --card: #ffffff; --input: #f1f5f9; --text: #1a2a44;
        --shadow: 0 8px 32px rgba(0,0,0,0.08);
        --border: rgba(0,212,255,0.15);
      }
      body {
        background: linear-gradient(135deg, #f8faff 0%, #e6f0ff 100%);
      }
      .card {
        box-shadow: var(--shadow);
        border: 1px solid rgba(0,0,0,0.05);
      }
    }
    @media (max-width: 640px) {
      h1 { font-size: 2.2rem; }
      .card { padding: 1.5rem; }
      .btn-group { justify-content: center; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo"></div>
      <h1>PayPal AI P2P Shield</h1>
      <p class="tagline">Offline AI scam detection — 12 KB model, 30ms inference</p>
    </header>

    <div class="card">
      <h2>Scan Payment Note</h2>
      <div class="examples">
        <div class="example-chip" onclick="setExample('mom in hospital need $300 urgent')">Scam Example</div>
        <div class="example-chip" onclick="setExample('thanks for the $10 coffee')">Safe Example</div>
        <div class="example-chip" onclick="setExample('gift card refund $500 oops')">Overpayment</div>
      </div>
      <div class="input-group">
        <input id="noteInput" placeholder="Type or paste the PayPal note here..." aria-label="PayPal note" autocomplete="off" />
        <div class="btn-group">
          <button onclick="example(true)">Test Scam</button>
          <button onclick="example(false)">Test Safe</button>
          <button class="danger" id="flag" style="display:none" onclick="flag()">Flag as Scam</button>
        </div>
      </div>
      <div id="result" role="alert" aria-live="polite">
        <p style="opacity:0.7; font-weight:500;">Enter a payment note to begin scanning...</p>
      </div>
    </div>

    <div class="card">
      <p><strong>Developed by:</strong> <a href="https://cogninautlabs.com" target="_blank">Cogninaut Labs</a> <span class="badge">v3.0 Perfect</span></p>
      <p>100% on-device processing • No data transmitted • Works offline • Quantized 12 KB model</p>
    </div>

    <div class="footer">
      <p>© 2025 Cogninaut Labs. All rights reserved. Patent pending.</p>
    </div>
  </div>

  <!-- WASM + TF.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-wasm@4.10.0/dist/tf-wasm.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.3"></script>
  <script>
    const $ = id => document.getElementById(id);
    const input = $('noteInput'), result = $('result'), flag = $('flag');
    let use, model, ready = false, timer;
    const CONFIG = { THRESHOLD: 68, DEBOUNCE: 280 };
    const CACHE = 'p2p_shield_v3';

    // Levenshtein for fuzzy match
    const lev = (a, b) => {
      const m = [];
      for (let i = 0; i <= b.length; i++) { m[i] = [i]; }
      for (let j = 0; j <= a.length; j++) { m[0][j] = j; }
      for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
          m[i][j] = b[i-1] === a[j-1] ? m[i-1][j-1] : Math.min(m[i-1][j-1] + 1, m[i][j-1] + 1, m[i-1][j] + 1);
        }
      }
      return m[b.length][a.length];
    };
    const fuzzy = (text, word) => {
      const clean = text.toLowerCase().replace(/0/g,'o').replace(/1/g,'i').replace(/[^a-z]/g,'');
      return clean.includes(word) || lev(clean, word) <= 2;
    };
    const rules = text => {
      let score = 0;
      const lower = text.toLowerCase();
      if (/\$\d{2,}|\d{2,}\s*(usd|eur|gbp)|\b(100|[2-9]\d{2,})\b/i.test(text)) score += 34;
      if (/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}]/u.test(text)) score += 23;
      const trig = ['urgent','now','asap','pls','mom','dad','sick','gift','refund','oops','hospital','emergency'];
      trig.forEach(w => { if (fuzzy(lower, w)) score += 11; });
      return Math.min(score, 90);
    };

    const load = async () => {
      if (ready) return;
      result.innerHTML = `
        <p style="color:#00d4ff; font-weight:600;">
          <span style="display:inline-block; width:16px; height:16px; border:2px solid #00d4ff; border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite; margin-right:0.5rem;"></span>
          Loading ultra-light 12 KB AI model...
        </p>
        <style>@keyframes spin{to{transform:rotate(360deg)}}</style>
      `;
      result.style.background = 'rgba(0,212,255,0.1)';
      await tf.setBackend('wasm');
      await tf.ready();
      use = await use.load();
      model = await tf.loadLayersModel('model/model.json');
      ready = true;
      localStorage.setItem(CACHE, '1');
      result.innerHTML = `<p style="color:#00ff88; font-weight:600;">AI Shield Active & Ready</p>`;
      result.style.background = 'rgba(0,255,136,0.15)';
    };

    const scan = async () => {
      const text = input.value.trim();
      if (!text) {
        result.innerHTML = '<p style="opacity:0.7; font-weight:500;">Enter a payment note to begin scanning...</p>';
        result.style.background = 'rgba(255,255,255,0.05)';
        flag.style.display = 'none';
        return;
      }

      const r = rules(text);
      if (r > 80) { blocked(r, 'Heuristic Rules'); return; }

      result.innerHTML = `
        <p style="color:#ffd43b; font-weight:600;">
          <span style="display:inline-block; width:16px; height:16px; border:2px solid #ffd43b; border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite; margin-right:0.5rem;"></span>
          AI analyzing language patterns...
        </p>
      `;
      result.style.background = 'rgba(255,212,59,0.1)';

      await load();
      let ai = r;
      try {
        const emb = await use.embed([text]);
        const pred = model.predict(emb);
        ai = Math.round(pred.dataSync()[0] * 100);
      } catch (e) { console.warn(e); }

      const final = Math.max(r, ai);
      final > CONFIG.THRESHOLD ? blocked(final, ai > r ? 'Neural AI' : 'Rules + AI') : clear(final);
    };

    const blocked = (risk, src) => {
      result.style.background = 'rgba(255,59,92,0.15)';
      result.innerHTML = `
        <p class="status" style="color:#ff3b5c;">
          <span class="status-icon" style="background:#ff3b5c; color:white;">X</span>
          BLOCKED – ${risk}% RISK
        </p>
        <p class="meta"><strong>Detected by:</strong> ${src}</p>
        <p class="meta">Do NOT send money. Verify sender identity first.</p>
        <div class="risk-bar"><div class="risk-fill" style="width:${risk}%"></div></div>
      `;
      flag.style.display = 'inline-flex';
    };

    const clear = risk => {
      result.style.background = 'rgba(0,255,136,0.15)';
      result.innerHTML = `
        <p class="status" style="color:#00ff88;">
          <span class="status-icon" style="background:#00ff88; color:#0a1d37;">Check</span>
          CLEAR – ${risk}% RISK
        </p>
        <p class="meta">No scam patterns detected. Transaction appears safe.</p>
        <div class="risk-bar"><div class="risk-fill" style="width:${risk}%"></div></div>
      `;
      flag.style.display = 'none';
    };

    const debounce = (fn, d) => { return (...a) => { clearTimeout(timer); timer = setTimeout(() => fn(...a), d); }; };
    input.addEventListener('input', debounce(scan, CONFIG.DEBOUNCE));

    window.example = scam => {
      input.value = scam ? 'mom in hospital need $300 urgent pls' : 'thanks for the $10 coffee!';
      scan();
    };

    window.setExample = text => {
      input.value = text;
      scan();
    };

    window.flag = () => {
      const flags = JSON.parse(localStorage.getItem('flags') || '[]');
      flags.push({text: input.value, time: Date.now()});
      localStorage.setItem('flags', JSON.stringify(flags.slice(-100)));
      alert('Scam pattern flagged for review. Thank you for helping improve the shield!');
    };

    // Init
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(() => {});
    }
    if (localStorage.getItem(CACHE)) load().catch(() => {});
  </script>
</body>
</html>
